<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Test one thing in one test function | Sirex web log</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://sirex.lt/posts/2019/test-one-thing-in-one-test-function/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Sirex">
<link rel="prev" href="../duomenu-atverimas-igauna-pagreiti/" title="Duomenų atvėrimas įgauna pagreitį" type="text/html">
<link rel="next" href="../../2020/duomenu-atverimo-vyriausiasis-specialistas/" title="Duomenų atvėrimo vyriausiasis specialistas" type="text/html">
<meta property="og:site_name" content="Sirex web log">
<meta property="og:title" content="Test one thing in one test function">
<meta property="og:url" content="https://sirex.lt/posts/2019/test-one-thing-in-one-test-function/">
<meta property="og:description" content="When writing tests, we usually want to test multiple things in one test
function. We do that, because this way we need to write less. For example:

import pytest
import sqlite3

@pytest.fixture()
def ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-01-02T13:53:26+02:00">
<meta property="article:tag" content="python">
<meta property="article:tag" content="testing">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         <main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">Test one thing in one test function</h1>
        <div class="metadata">
            <p class="dateline">
            <time class="published dt-published" datetime="2020-01-02T13:53:26+02:00" itemprop="datePublished" title="2020-01-02 13:53">2020-01-02 13:53</time>

                |
                <span itemprop="keywords" class="tags">
                    <a class="tag p-category" href="../../../tags/python/" rel="tag">python</a>,                    <a class="tag p-category" href="../../../tags/testing/" rel="tag">testing</a>                </span>

            </p>
        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>When writing tests, we usually want to test multiple things in one test
function. We do that, because this way we need to write less. For example:</p>
<!-- run: env/bin/py.test -vvx - -color=yes %s -->
<div class="code"><pre class="code python"><a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-1" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-1" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-1"></a><span class="kn">import</span> <span class="nn">pytest</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-2" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-2" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-2"></a><span class="kn">import</span> <span class="nn">sqlite3</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-3" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-3" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-3"></a>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-4" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-4" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-5" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-5" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-5"></a><span class="k">def</span> <span class="nf">db</span><span class="p">():</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-6" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-6" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-6"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">':memory:'</span><span class="p">)</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-7" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-7" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-7"></a>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'CREATE TABLE t (key TEXT, val TEXT)'</span><span class="p">)</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-8" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-8" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-8"></a>    <span class="k">return</span> <span class="n">conn</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-9" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-9" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-9"></a>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-10" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-10" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-10"></a><span class="k">def</span> <span class="nf">test_sqlite</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-11" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-11" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-11"></a>    <span class="c1"># setup</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-12" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-12" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-12"></a>    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'INSERT INTO t (key, val) VALUES ("foo", "bar")'</span><span class="p">)</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-13" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-13" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-13"></a>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-14" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-14" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-14"></a>    <span class="c1"># test 1</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-15" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-15" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-15"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM t;'</span><span class="p">)</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-16" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-16" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-16"></a>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)]</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-17" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-17" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-17"></a>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-18" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-18" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-18"></a>    <span class="c1"># test ...</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-19" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-19" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-19"></a>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-20" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-20" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-20"></a>    <span class="c1"># test N</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-21" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-21" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-21"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM t WHERE key = "foo";'</span><span class="p">)</span>
<a id="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-22" name="rest_code_cbad546e1fe64637a56a45a4daa6e1ca-22" href="#rest_code_cbad546e1fe64637a56a45a4daa6e1ca-22"></a>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)]</span>
</pre></div>
<p>Here we have a test, where two separate things are tested. It is convenient to
write tests this way, because we only need to do setup once and then test
multiple things on the same setup.</p>
<p>Lets assume, that we wrote <code class="docutils literal">sqlite3</code> module our tests fail at <code class="docutils literal">test N</code> step. We
need to debug what is going one. Usually debuggin requires to hook into for example <code class="docutils literal">db.execute</code> and print some things or run a debugger like <a class="reference external" href="https://docs.python.org/3/library/pdb.html">pdb</a>.</p>
<p>Since failure is only happens on last <code class="docutils literal">test N</code> step, <code class="docutils literal">db.execute</code> debugging
becomse quite complicated, because in this one test we run <code class="docutils literal">db.execute</code>
multiple times. That means, we will see too much irrelevant output, which makes
it difficult to see only relevate output from our last <code class="docutils literal">test N</code> step.</p>
<p>Usually I end up splitting such tests into many separate tests in order to make
debugging easier. For example, this test above could be split like this:</p>
<div class="code"><pre class="code python"><a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-1" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-1" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-2" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-2" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-2"></a><span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-3" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-3" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-3"></a>    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'INSERT INTO t (key, val) VALUES ("foo", "bar")'</span><span class="p">)</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-4" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-4" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-4"></a>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-5" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-5" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-5"></a><span class="k">def</span> <span class="nf">test_sqlite_1</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-6" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-6" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-6"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM t;'</span><span class="p">)</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-7" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-7" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-7"></a>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)]</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-8" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-8" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-8"></a>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-9" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-9" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-9"></a><span class="k">def</span> <span class="nf">test_sqlite_N</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-10" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-10" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-10"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM t WHERE key = "foo";'</span><span class="p">)</span>
<a id="rest_code_c66453cc45b049d89cf2fca6f9fee401-11" name="rest_code_c66453cc45b049d89cf2fca6f9fee401-11" href="#rest_code_c66453cc45b049d89cf2fca6f9fee401-11"></a>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)]</span>
</pre></div>
<p>Now that is much better. I can run just <code class="docutils literal">test_sqlite_N</code> and when debuggin, I
will see only relevant output.</p>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../duomenu-atverimas-igauna-pagreiti/" rel="prev" title="Duomenų atvėrimas įgauna pagreitį">Previous post</a>
            </li>
            <li class="next">
                <a href="../../2020/duomenu-atverimo-vyriausiasis-specialistas/" rel="next" title="Duomenų atvėrimo vyriausiasis specialistas">Next post</a>
            </li>
        </ul></nav></aside><nav id="menu"><ul>
<li><a href="../../../">Index</a></li>
                <li><a href="../../">Archive</a></li>
                <li><a href="../../../tags/">Tags</a></li>
                <li><a href="../../../rss.xml"><span class="caps">RSS</span> feed</a></li>

    
    
    
    </ul></nav></article></main>
</div>
                <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-N9F34JEJNF"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-N9F34JEJNF');
</script>
</body>
</html>