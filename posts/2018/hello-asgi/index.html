<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Hello ASGI | Sirex web log</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://sirex.lt/posts/2018/hello-asgi/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Sirex">
<link rel="prev" href="../../2019/penciju-fondai/" title="Pencijų fondai" type="text/html">
<link rel="next" href="../kaip-galetu-atrodyti-lietuvos-atviru-duomenu-portalas/" title="Kaip galėtų atrodyti Lietuvos atvirų duomenų portalas" type="text/html">
<meta property="og:site_name" content="Sirex web log">
<meta property="og:title" content="Hello ASGI">
<meta property="og:url" content="https://sirex.lt/posts/2018/hello-asgi/">
<meta property="og:description" content="Python programming language has WSGI (Web Server Gateway Interface) standard,
where web servers can talk to apps using same standartized protocol. Simplest
WSGI application looks like this:
import jso">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-03-30T00:00:00+03:00">
<meta property="article:tag" content="asgi">
<meta property="article:tag" content="python">
<meta property="article:tag" content="web">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         <main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">Hello ASGI</h1>
        <div class="metadata">
            <p class="dateline">
            <time class="published dt-published" datetime="2018-03-30T00:00:00+03:00" itemprop="datePublished" title="2018-03-30 00:00">2018-03-30 00:00</time>

                |
                <span itemprop="keywords" class="tags">
                    <a class="tag p-category" href="../../../tags/asgi/" rel="tag">asgi</a>,                    <a class="tag p-category" href="../../../tags/python/" rel="tag">python</a>,                    <a class="tag p-category" href="../../../tags/web/" rel="tag">web</a>                </span>

            </p>
        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Python programming language has <a class="reference external" href="https://www.python.org/dev/peps/pep-0333/">WSGI</a> (Web Server Gateway Interface) standard,
where web servers can talk to apps using same standartized protocol. Simplest
WSGI application looks like this:</p>
<pre class="code python"><a name="rest_code_398f2c0a294c437496d8540a69fd70fe-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-2"></a>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-3"></a><span class="k">def</span> <span class="nf">wsgi</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-4"></a>    <span class="n">start_response</span><span class="p">(</span><span class="s1">'200 OK'</span><span class="p">,</span> <span class="p">[</span>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-5"></a>        <span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'application/json'</span><span class="p">),</span>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-6"></a>    <span class="p">])</span>
<a name="rest_code_398f2c0a294c437496d8540a69fd70fe-7"></a>    <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">repr</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre>
<p>Response:</p>
<pre class="code json"><a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-1"></a><span class="p">{</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-2"></a>  <span class="nt">"wsgi.errors"</span><span class="p">:</span> <span class="s2">"&lt;gunicorn.http.wsgi.WSGIErrorsWrapper object at 0x7fe381c1aef0&gt;"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-3"></a>  <span class="nt">"wsgi.version"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-4"></a>  <span class="nt">"wsgi.multithread"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-5"></a>  <span class="nt">"wsgi.multiprocess"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-6"></a>  <span class="nt">"wsgi.run_once"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-7"></a>  <span class="nt">"wsgi.file_wrapper"</span><span class="p">:</span> <span class="s2">"&lt;class 'gunicorn.http.wsgi.FileWrapper'&gt;"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-8"></a>  <span class="nt">"SERVER_SOFTWARE"</span><span class="p">:</span> <span class="s2">"gunicorn/19.7.1"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-9"></a>  <span class="nt">"wsgi.input"</span><span class="p">:</span> <span class="s2">"&lt;gunicorn.http.body.Body object at 0x7fe381c1af60&gt;"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-10"></a>  <span class="nt">"gunicorn.socket"</span><span class="p">:</span> <span class="s2">"&lt;socket.socket fd=9, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000), raddr=('127.0.0.1', 59066)&gt;"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-11"></a>  <span class="nt">"REQUEST_METHOD"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-12"></a>  <span class="nt">"QUERY_STRING"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-13"></a>  <span class="nt">"RAW_URI"</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-14"></a>  <span class="nt">"SERVER_PROTOCOL"</span><span class="p">:</span> <span class="s2">"HTTP/1.1"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-15"></a>  <span class="nt">"HTTP_HOST"</span><span class="p">:</span> <span class="s2">"localhost:8000"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-16"></a>  <span class="nt">"HTTP_USER_AGENT"</span><span class="p">:</span> <span class="s2">"curl/7.59.0"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-17"></a>  <span class="nt">"HTTP_ACCEPT"</span><span class="p">:</span> <span class="s2">"*/*"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-18"></a>  <span class="nt">"HTTP_CONNECTION"</span><span class="p">:</span> <span class="s2">"Upgrade, HTTP2-Settings"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-19"></a>  <span class="nt">"HTTP_UPGRADE"</span><span class="p">:</span> <span class="s2">"h2c"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-20"></a>  <span class="nt">"HTTP_HTTP2_SETTINGS"</span><span class="p">:</span> <span class="s2">"AAMAAABkAARAAAAAAAIAAAAA"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-21"></a>  <span class="nt">"wsgi.url_scheme"</span><span class="p">:</span> <span class="s2">"http"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-22"></a>  <span class="nt">"REMOTE_ADDR"</span><span class="p">:</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-23"></a>  <span class="nt">"REMOTE_PORT"</span><span class="p">:</span> <span class="s2">"59066"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-24"></a>  <span class="nt">"SERVER_NAME"</span><span class="p">:</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-25"></a>  <span class="nt">"SERVER_PORT"</span><span class="p">:</span> <span class="s2">"8000"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-26"></a>  <span class="nt">"PATH_INFO"</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-27"></a>  <span class="nt">"SCRIPT_NAME"</span><span class="p">:</span> <span class="s2">""</span>
<a name="rest_code_feb1b352a0ce4f33bb33940a652fbec4-28"></a><span class="p">}</span>
</pre>
<p>Now there is a new standard emerging, called <a class="reference external" href="https://github.com/django/asgiref/blob/master/specs/asgi.rst">ASGI</a> (Asynchronous Server Gateway
Interface). This new standard tries to fix WSGI limitations and provides more
flexible interface, that can support multiple protocols like HTTP, HTTP/2,
WebSockets and others. In addition ASGI provides possibility to use asyncio in
web apps. Simples ASGI application looks like this:</p>
<pre class="code python"><a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-2"></a>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-3"></a>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-4"></a><span class="k">def</span> <span class="nf">asgi</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-5"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">chat</span><span class="p">(</span><span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-6"></a>        <span class="k">await</span> <span class="n">receive</span><span class="p">()</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-7"></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-8"></a>            <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'http.response.start'</span><span class="p">,</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-9"></a>            <span class="s1">'status'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-10"></a>            <span class="s1">'headers'</span><span class="p">:</span> <span class="p">[</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-11"></a>                <span class="p">[</span><span class="sa">b</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="sa">b</span><span class="s1">'application/json'</span><span class="p">],</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-12"></a>            <span class="p">],</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-13"></a>        <span class="p">})</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-14"></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-15"></a>            <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'http.response.body'</span><span class="p">,</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-16"></a>            <span class="s1">'body'</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-17"></a>        <span class="p">})</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-18"></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-19"></a>            <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'http.disconnect'</span><span class="p">,</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-20"></a>        <span class="p">})</span>
<a name="rest_code_1a928e7563ab45ec91bc25d5fa2c57d8-21"></a>    <span class="k">return</span> <span class="n">chat</span>
</pre>
<p>Response:</p>
<pre class="code json"><a name="rest_code_998ded213c6e4080b5aa781052e87790-1"></a><span class="p">{</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-2"></a>  <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"http"</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-3"></a>  <span class="nt">"http_version"</span><span class="p">:</span> <span class="s2">"2"</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-4"></a>  <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-5"></a>  <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-6"></a>  <span class="nt">"root_path"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-7"></a>  <span class="nt">"scheme"</span><span class="p">:</span> <span class="s2">"https"</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-8"></a>  <span class="nt">"query_string"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-9"></a>  <span class="nt">"headers"</span><span class="p">:</span> <span class="p">[</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-10"></a>    <span class="p">[</span><span class="s2">"host"</span><span class="p">,</span> <span class="s2">"localhost:8000"</span><span class="p">],</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-11"></a>    <span class="p">[</span><span class="s2">"user-agent"</span><span class="p">,</span> <span class="s2">"curl/7.59.0"</span><span class="p">],</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-12"></a>    <span class="p">[</span><span class="s2">"accept"</span><span class="p">,</span> <span class="s2">"*/*"</span><span class="p">]</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-13"></a>  <span class="p">],</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-14"></a>  <span class="nt">"client"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="mi">59012</span><span class="p">],</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-15"></a>  <span class="nt">"server"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">]</span>
<a name="rest_code_998ded213c6e4080b5aa781052e87790-16"></a><span class="p">}</span>
</pre>
<p>ASGI is a bit more complicated, but gives support for modern web protocols and
<em>asyncio</em>.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../2019/penciju-fondai/" rel="prev" title="Pencijų fondai">Previous post</a>
            </li>
            <li class="next">
                <a href="../kaip-galetu-atrodyti-lietuvos-atviru-duomenu-portalas/" rel="next" title="Kaip galėtų atrodyti Lietuvos atvirų duomenų portalas">Next post</a>
            </li>
        </ul></nav></aside><nav id="menu"><ul>
<li><a href="../../../">Index</a></li>
                <li><a href="../../">Archive</a></li>
                <li><a href="../../../tags/">Tags</a></li>
                <li><a href="../../../rss.xml">RSS feed</a></li>

    
    
    
    </ul></nav></article></main>
</div>
                <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>